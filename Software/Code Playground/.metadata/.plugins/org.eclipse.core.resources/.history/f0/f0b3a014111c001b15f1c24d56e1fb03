/*
 * debug.c
 *
 *  Created on: Nov 1, 2020
 *      Author: monke
 */
#include "debug.h"

void print_AX25(){
	struct PACKET_STRUCT* local_packet = &global_packet;
	int bytecnt = local_packet->byte_cnt;
	bool *curr_mem;
	sprintf(uartData, "\nPrinting AX25_PACKET... All fields printed [MSB:LSB]\n");
	HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);

	//Print Address Field
	curr_mem = (local_packet->AX25_PACKET) + address_len - 1;
	for(int i = 0;i<address_len/8;i++){
		sprintf(uartData, "Address Field %d =",i+1);
		HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);

		for(int j = 0;j<8;j++){
			sprintf(uartData, " %d ",*(curr_mem-j));
			HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);
		}
		curr_mem -= 8;
		sprintf(uartData, "\n");
		HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);
	}

	//Print Control Field
	curr_mem += address_len;//Subtract 8 to start at the flag start
	sprintf(uartData, "Control Field   =");
	HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);

	for(int i = 0;i<8;i++){
		sprintf(uartData, " %d ",*(curr_mem+8-i-1));
		HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);
	}
	sprintf(uartData, "\n");
	HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);

	//PID
	curr_mem += control_len;//Subtract 8 to start at the flag start
	sprintf(uartData, "PID Field       =");
	HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);

	for(int i = 0;i<8;i++){
		sprintf(uartData, " %d ",*(curr_mem+8-i-1));
		HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);
	}
	sprintf(uartData, "\n");
	HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);
	curr_mem += PID_len;

	//Print Info Field
	curr_mem += local_packet->Info_Len - 1;
	for(int i = 0;i<(local_packet->Info_Len/8);i++){
		sprintf(uartData, "Info Field %d    =",i+1)	;
		HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);

		for(int j = 0;j<8;j++){
			sprintf(uartData, " %d ",*(curr_mem-j));
			HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);
		}
		curr_mem -= 8;
		sprintf(uartData, "\n");
		HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);
	}
	curr_mem += local_packet->Info_Len;

	curr_mem += FCS_len - 8;
	for(int i = 0;i<(FCS_len/8);i++){
		sprintf(uartData, "FCS Field %d     =",i+1)	;
		HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);

		for(int j = 0;j<8;j++){
			sprintf(uartData, " %d ",*(curr_mem+8-j-1));
			HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);
		}
		curr_mem -= 8;
		sprintf(uartData, "\n");
		HAL_UART_Transmit(&huart2, uartData, strlen(uartData), 10);
	}
}
